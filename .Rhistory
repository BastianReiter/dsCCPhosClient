do.call(ggTheme, c(list(...),
list(Theme_SizeFactorTickLabels_x = 1.3),      # Increase x axis tick label text size by default
ThemeArguments)) +      # Pass additional optional arguments
geom_boxplot(stat = "identity",
width = 0.4,
alpha = 0.7,
outlier.shape = NA,
show.legend = FALSE) +
geom_point(aes(y = mean), color = "red", size = 2, shape = 19) +
labs(x = AxisTitle_x,
y = AxisTitle_y) +
#--- Option: If no axis title, delete space for label --------------
{
if (AxisTitle_x == "") { theme(axis.title.x = element_blank()) }
} + {
if (AxisTitle_y == "") { theme(axis.title.y = element_blank()) }
} +
scale_x_discrete(labels = label_wrap(TickLabelWidth_x)) +      # Set width of x axis tick mark labels, after which linebreak should occur
scale_y_continuous(labels = function(value) round(value, Decimals)) +
ylim(AxisLimits_y[1], AxisLimits_y[2]) +      # Set y axis limits
scale_fill_manual(values = FillPalette)      # Set custom fill color palette
SampleStatistics <- ds.GetSampleStatistics(TableName = "ADS_Patients",
MetricFeatureName = "PatientAgeAtDiagnosis",
DataSources = CCPConnections) %>%
MakeBoxPlot()
??label_wrap
# Adding package dependencies using usethis::use_package()
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# use_package("dplyr")
# use_package("DSI")
# use_package("ggplot2", type = "Suggests")
use_package("scales", type = "Suggests")
devtools::load_all(".")
SampleStatistics <- ds.GetSampleStatistics(TableName = "ADS_Patients",
MetricFeatureName = "PatientAgeAtDiagnosis",
DataSources = CCPConnections) %>%
MakeBoxPlot()
SampleStatistics
SampleStatistics <- ds.GetSampleStatistics(TableName = "ADS_Patients",
MetricFeatureName = "PatientAgeAtDiagnosis",
DataSources = CCPConnections) %>%
TestPlot <- MakeBoxPlot(SampleStatistics)
SampleStatistics <- ds.GetSampleStatistics(TableName = "ADS_Patients",
MetricFeatureName = "PatientAgeAtDiagnosis",
DataSources = CCPConnections) %>%
TestPlot <- MakeBoxPlot(SampleStatistics)
SampleStatistics <- ds.GetSampleStatistics(TableName = "ADS_Patients",
MetricFeatureName = "PatientAgeAtDiagnosis",
DataSources = CCPConnections)
TestPlot <- MakeBoxPlot(SampleStatistics)
TestPlot
devtools::load_all(".")
TestPlot <- MakeBoxPlot(SampleStatistics)
TestPlot
AlphaPalettes <- list(Levels_2 <- c(0.5, 0.9),
Levels_3 <- c(0.2, 0.5, 0.9),
Levels_4 <- c(0.3, 0.5, 0.7, 0.9),
Levels_5 <- c(0.4, 0.5, 0.6, 0.7, 0.8))
# Save data in .rda-file and make it part of package
use_data(AlphaPalettes, overwrite = TRUE)
Colors <- list(LightGrey = "#EDEDED",
MediumGrey = "#D0D0D0",
DarkGrey = "#595959",
#---------
Primary = "#054996",
PrimaryLight = "#05499650",
Secondary = "#8e1e39",
SecondaryLight = "#8e1e3950",
Tertiary = "#2B8C88",
TertiaryLight = "#2B8C8850",
#---------
Accent = "#960551",
AccentLight = "#96055150",
#---------
BlueNice = "#7EA6E0")
# Save data in .rda-file and make it part of package
use_data(Colors, overwrite = TRUE)
devtools::load_all(".")
devtools::load_all(".")
TestPlot <- MakeBoxPlot(SampleStatistics)
TestPlot
devtools::load_all(".")
TestPlot <- MakeBoxPlot(SampleStatistics = SampleStatistics,
AxisTitle_y = "Patient age at diagnosis")
TestPlot
TestPlot <- MakeBoxPlot(SampleStatistics = SampleStatistics,
AxisTitle_y = "Patient age at diagnosis",
FillPalette = Colors$BlueNice)
warnings()
TestPlot
TestPlot <- MakeBoxPlot(SampleStatistics = SampleStatistics,
AxisTitle_y = "Patient age at diagnosis",
FillPalette = c("All" = Colors$BlueNice))
TestPlot
TestPlot <- MakeBoxPlot(SampleStatistics = SampleStatistics,
AxisTitle_y = "Patient age at diagnosis",
FillPalette = c("All" = Colors$BlueNice,
"SiteA" = Colors$Primary,
"SiteB" = Colors$Secondary,
"SiteC" = Colors$Tertiary))
TestPlot
Colors$BlueNice
TestPlot <- MakeBoxPlot(SampleStatistics = SampleStatistics,
AxisTitle_y = "Patient age at diagnosis",
FillPalette = c(Colors$BlueNice,
Colors$Primary,
Colors$Secondary,
Colors$Tertiary))
TestPlot
devtools::load_all(".")
TestPlot <- MakeBoxPlot(SampleStatistics = SampleStatistics,
AxisTitle_y = "Patient age at diagnosis",
FillPalette = c(Colors$BlueNice,
Colors$Primary,
Colors$Secondary,
Colors$Tertiary))
TestPlot
Colors$DarkGrey
warnings()
library(dsCCPhosClient)
devtools::load_all(".")
# Load needed packages
library(dsBase)
library(dsBaseClient)
library(dsCCPhos)
library(dsCCPhosClient)
library(DSLite)
load("../dsCCPhos/Development/Data/TestData/CCPTestData_Small_A.RData")
load("../dsCCPhos/Development/Data/TestData/CCPTestData_Small_B.RData")
load("../dsCCPhos/Development/Data/TestData/CCPTestData_Small_C.RData")
CCPTestData_A <- CCPTestData_Small_A
CCPTestData_B <- CCPTestData_Small_B
CCPTestData_C <- CCPTestData_Small_C
Server_SiteA <- newDSLiteServer(tables = CCPTestData_A,
config = DSLite::defaultDSConfiguration(include = c("dsBase",
"dsCCPhos")))
Server_SiteB <- newDSLiteServer(tables = CCPTestData_B,
config = DSLite::defaultDSConfiguration(include = c("dsBase",
"dsCCPhos")))
Server_SiteC <- newDSLiteServer(tables = CCPTestData_C,
config = DSLite::defaultDSConfiguration(include = c("dsBase",
"dsCCPhos")))
# Returns an environment
LoginBuilder <- DSI::newDSLoginBuilder(.silent = FALSE)
LoginBuilder$append(server = "SiteA",
url = "Server_SiteA",
driver = "DSLiteDriver")
LoginBuilder$append(server = "SiteB",
url = "Server_SiteB",
driver = "DSLiteDriver")
LoginBuilder$append(server = "SiteC",
url = "Server_SiteC",
driver = "DSLiteDriver")
# Returns a data frame of login data to servers
LoginData <- LoginBuilder$build()
# Get list of DSConnection objects of all servers
CCPConnections <- DSI::datashield.login(logins = LoginData,
assign = TRUE)
# Get info about installed packages on servers
DSI::datashield.pkg_status(conns = CCPConnections)
# Get table names of CCP core data set
CCPTableNames_Raw <- dsCCPhos::Meta_TableNames$TableName_Raw
CCPTableNames_Curated <- dsCCPhos::Meta_TableNames$TableName_Curated
# Make tables from data repository accessible in R session
for(i in 1:length(CCPTableNames_Curated))
{
datashield.assign(conns = CCPConnections,
symbol = CCPTableNames_Curated[i],
value = CCPTableNames_Curated[i],
id.name = "_id")
}
# Consolidate all raw data tables in one list object called "RawDataSet"
ds.list(x = CCPTableNames_Curated,
newobj = "RawDataSet",
datasources = CCPConnections)
# Transform Raw Data Set (RDS) into Curated Data Set (CDS)
dsCCPhosClient::ds.CurateData(Name_RawDataSet = "RawDataSet",
Name_Output = "CurationOutput",
DataSources = CCPConnections)
# Try out data augmentation method
dsCCPhosClient::ds.AugmentData(Name_CurationOutput = "CurationOutput",
Name_Output = "AugmentationOutput",
DataSources = CCPConnections)
# Make tables from Augmented Data Set directly addressable by unpacking them into R server session
dsCCPhosClient::ds.UnpackAugmentedDataSet(Name_AugmentationOutput = "AugmentationOutput",
DataSources = CCPConnections)
SampleStatistics <- ds.GetSampleStatistics(TableName = "ADS_Patients",
MetricFeatureName = "PatientAgeAtDiagnosis",
DataSources = CCPConnections)
TestPlot <- MakeBoxPlot(SampleStatistics = SampleStatistics,
AxisTitle_y = "Patient age at diagnosis",
FillPalette = c(Colors$BlueNice,
Colors$Primary,
Colors$Secondary,
Colors$Tertiary))
TestPlot
?geom_boxplot
?scale_fill_manual
# Data visualization
#~~~~~~~~~~~~~~~~~~~
# use_r("MakeBoxPlot.R")
# use_r("ggTheme_CCP")
use_r("gtTheme_CCP")
library(devtools)
# Data visualization
#~~~~~~~~~~~~~~~~~~~
# use_r("MakeBoxPlot.R")
# use_r("ggTheme_CCP")
use_r("gtTheme_CCP")
# Adding package dependencies using usethis::use_package()
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# use_package("dplyr")
# use_package("DSI")
# use_package("ggplot2", type = "Suggests")
use_package("gt", type = "Suggests")
# Data visualization
#~~~~~~~~~~~~~~~~~~~
use_r("ExportPlot.R")
# Returns an environment
LoginBuilder <- DSI::newDSLoginBuilder(.silent = FALSE)
LoginBuilder$append(server = "SiteA",
url = "Server_SiteA",
driver = "DSLiteDriver")
LoginBuilder$append(server = "SiteB",
url = "Server_SiteB",
driver = "DSLiteDriver")
LoginBuilder$append(server = "SiteC",
url = "Server_SiteC",
driver = "DSLiteDriver")
# Returns a data frame of login data to servers
LoginData <- LoginBuilder$build()
# Get list of DSConnection objects of all servers
CCPConnections <- DSI::datashield.login(logins = LoginData,
assign = TRUE)
# Get table names of CCP core data set
CCPTableNames_Raw <- dsCCPhos::Meta_TableNames$TableName_Raw
CCPTableNames_Curated <- dsCCPhos::Meta_TableNames$TableName_Curated
# Make tables from data repository accessible in R session
for(i in 1:length(CCPTableNames_Curated))
{
datashield.assign(conns = CCPConnections,
symbol = CCPTableNames_Curated[i],
value = CCPTableNames_Curated[i],
id.name = "_id")
}
# Consolidate all raw data tables in one list object called "RawDataSet"
ds.list(x = CCPTableNames_Curated,
newobj = "RawDataSet",
datasources = CCPConnections)
# List all objects in server-sided R sessions
DSI::datashield.symbols(conns = CCPConnections)
# Transform Raw Data Set (RDS) into Curated Data Set (CDS)
dsCCPhosClient::ds.CurateData(Name_RawDataSet = "RawDataSet",
Name_Output = "CurationOutput",
DataSources = CCPConnections)
# Get Curation reports
CurationReports <- dsCCPhosClient::ds.GetCurationReport(Name_CurationOutput = "CurationOutput",
DataSources = CCPConnections)
# List all objects in server-sided R sessions
DSI::datashield.symbols(conns = CCPConnections)
# Try out data augmentation method
dsCCPhosClient::ds.AugmentData(Name_CurationOutput = "CurationOutput",
Name_Output = "AugmentationOutput",
DataSources = CCPConnections)
# Make tables from Augmented Data Set directly addressable by unpacking them into R server session
dsCCPhosClient::ds.UnpackAugmentedDataSet(Name_AugmentationOutput = "AugmentationOutput",
DataSources = CCPConnections)
SampleStatistics <- ds.GetSampleStatistics(TableName = "ADS_Patients",
MetricFeatureName = "PatientAgeAtDiagnosis",
DataSources = CCPConnections)
SampleStatistics
TestPlot <- MakeBoxPlot(SampleStatistics = SampleStatistics,
AxisTitle_y = "Patient age at diagnosis",
FillPalette = c(Colors$BlueNice,
Colors$Primary,
Colors$Secondary,
Colors$Tertiary))
TestPlot
SampleStatistics <- ds.GetSampleStatistics(TableName = "ADS_Patients",
MetricFeatureName = "PatientAgeAtDiagnosis",
DataSources = CCPConnections)
SampleStatistics
?scale_fill_brewer
devtools::load_all(".")
TestPlot <- MakeBoxPlot(SampleStatistics = SampleStatistics,
AxisTitle_y = "Patient age at diagnosis",
FillPalette = c(Colors$BlueNice,
Colors$Primary,
Colors$Secondary,
Colors$Tertiary))
TestPlot
devtools::load_all(".")
TestPlot <- MakeBoxPlot(SampleStatistics = SampleStatistics,
AxisTitle_y = "Patient age at diagnosis",
FillPalette = c(Colors$BlueNice,
Colors$Primary,
Colors$Secondary,
Colors$Tertiary))
TestPlot
devtools::load_all(".")
TestPlot <- MakeBoxPlot(SampleStatistics = SampleStatistics,
AxisTitle_y = "Patient age at diagnosis",
FillPalette = c(Colors$BlueNice,
Colors$Primary,
Colors$Secondary,
Colors$Tertiary))
TestPlot
devtools::load_all(".")
TestPlot <- MakeBoxPlot(SampleStatistics = SampleStatistics,
AxisTitle_y = "Patient age at diagnosis",
FillPalette = c(Colors$BlueNice,
Colors$Primary,
Colors$Secondary,
Colors$Tertiary))
TestPlot
devtools::load_all(".")
TestPlot <- MakeBoxPlot(SampleStatistics = SampleStatistics,
AxisTitle_y = "Patient age at diagnosis",
FillPalette = c(Colors$BlueNice,
Colors$Primary,
Colors$Secondary,
Colors$Tertiary))
TestPlot
TestPlot <- MakeBoxPlot(SampleStatistics = SampleStatistics,
AxisTitle_y = "Patient age at diagnosis",
FillPalette = c("All" = Colors$MediumGrey,
"SiteA" = Colors$Primary,
"SiteB" = Colors$Secondary,
"SiteC" = Colors$Tertiary))
TestPlot
devtools::load_all(".")
TestPlot <- MakeBoxPlot(SampleStatistics = SampleStatistics,
AxisTitle_y = "Patient age at diagnosis",
FillPalette = c("All" = Colors$MediumGrey,
"SiteA" = Colors$Primary,
"SiteB" = Colors$Secondary,
"SiteC" = Colors$Tertiary))
TestPlot
devtools::load_all(".")
TestPlot <- MakeBoxPlot(SampleStatistics = SampleStatistics,
AxisTitle_y = "Patient age at diagnosis",
FillPalette = c("All" = Colors$MediumGrey,
"SiteA" = Colors$Primary,
"SiteB" = Colors$Secondary,
"SiteC" = Colors$Tertiary))
TestPlot
?ds.meanSdGp
?ds.quantileMean
?ds.extractQuantiles
?ds.ranksSecure
ds.ranksSecure(input.var.name = "ADS_Patients$PatientAgeAtDiagnosis",
datasources = CCPConnections)
datashield.errors()
# Data visualization
#~~~~~~~~~~~~~~~~~~~
# use_r("ExportPlot.R")
# use_r("ggTheme_CCP")
# use_r("gtTheme_CCP")
# use_r("MakeBoxPlot.R")
use_r("MakeColumnPlot.R")
load("C:/Users/Basti/ARBEIT Lokal/dsCCPhosClient/Development/Reporting/MonitorData_Frankfurt.RData")
# Get Curation reports
CurationReports <- dsCCPhosClient::ds.GetCurationReport(Name_CurationOutput = "CurationOutput",
DataSources = CCPConnections)
?save
save(CurationReports$SiteA,
file = "../Reporting/TransformationMonitor.rda")
CurationReports$SiteA
# For testing purposes
TransformationMonitor <- CurationReports$SiteA
save(TransformationMonitor,
file = "../Reporting/TransformationMonitor.rda")
save(TransformationMonitor,
file = "./Development/Reporting/TransformationMonitor.rda")
#| label: Setup
#| echo: false
#| include: false
knitr::opts_chunk$set(echo = FALSE)
SiteName <- "Frankfurt"
source(here::here("Scripts/SETUP.R"))
#| label: Setup
#| echo: false
#| include: false
knitr::opts_chunk$set(echo = FALSE)
#SiteName <- "Frankfurt"
#source(here::here("Scripts/SETUP.R"))
load("./Development/Reporting/Monitoring/TransformationMonitor.rda")
load("./Development/Reporting/TransformationMonitor.rda")
#| label: HarmonizationMonitors
#| warning: false
load("./Development/Reporting/TransformationMonitor.rda")
#| label: HarmonizationMonitors
#| warning: false
load("TransformationMonitor.rda")
ls_Tables <- map(TransformationMonitor,
function(inp_df)
{
inp_df %>%
gt(groupname_col = "Feature") %>%
theme_gt_CDSG(inp_TableAlign = "left", inp_ShowNAs = TRUE, inp_TableWidth = "80%") %>%
tab_style(locations = cells_body(rows = (Value != "NA" & IsValueEligible == TRUE & Final > 0)),
style = cell_fill(color = "green")) %>%
tab_style(locations = cells_body(rows = (Value != "NA" & IsValueEligible == TRUE & Final == 0)),
style = cell_fill(color = "lightgreen")) %>%
tab_style(locations = cells_body(rows = (Value == "NA" | is.na(Value))),
style = cell_fill(color = "gray")) %>%
tab_style(locations = cells_body(columns = c(Value, IsValueEligible, Transformed),
rows = (Value != "NA" & IsValueEligible == FALSE & Transformed > 0 & Final == 0)),
style = cell_fill(color = "red")) %>%
tab_style(locations = cells_body(columns = c(Value, IsValueEligible, Raw, Transformed),
rows = (Value != "NA" & IsValueEligible == FALSE & Raw > 0 & Transformed == 0)),
style = cell_fill(color = "orange"))
})
#| label: Setup
#| echo: false
#| include: false
knitr::opts_chunk$set(echo = FALSE)
#SiteName <- "Frankfurt"
source(here::here("RSetup.R"))
#| label: Setup
#| echo: false
#| include: false
knitr::opts_chunk$set(echo = FALSE)
#SiteName <- "Frankfurt"
source("RSetup.R"))
#| label: Setup
#| echo: false
#| include: false
knitr::opts_chunk$set(echo = FALSE)
#SiteName <- "Frankfurt"
source("RSetup.R")
# Exemplary look at a curation report table
View(CurationReports$SiteA$Monitor_Staging)
# Exemplary look at a curation report table
View(CurationReports$SiteA$Monitor_Diagnosis)
# Exemplary look at a curation report table
View(CurationReports$SiteA$Monitor_Diagnosis)
View(CCPTestData_Small_A$Diagnosis)
# Load needed packages
library(dsBase)
library(dsBaseClient)
library(dsCCPhos)
library(dsCCPhosClient)
library(DSLite)
library(dsCCPhosClient)
# Load needed packages
library(dsBase)
library(dsBaseClient)
library(dsCCPhos)
library(dsCCPhosClient)
library(DSLite)
load("../dsCCPhos/Development/Data/TestData/CCPTestData_Small_A.RData")
load("../dsCCPhos/Development/Data/TestData/CCPTestData_Small_B.RData")
load("../dsCCPhos/Development/Data/TestData/CCPTestData_Small_C.RData")
CCPTestData_A <- CCPTestData_Small_A
CCPTestData_B <- CCPTestData_Small_B
CCPTestData_C <- CCPTestData_Small_C
Server_SiteA <- newDSLiteServer(tables = CCPTestData_A,
config = DSLite::defaultDSConfiguration(include = c("dsBase",
"dsCCPhos")))
Server_SiteB <- newDSLiteServer(tables = CCPTestData_B,
config = DSLite::defaultDSConfiguration(include = c("dsBase",
"dsCCPhos")))
Server_SiteC <- newDSLiteServer(tables = CCPTestData_C,
config = DSLite::defaultDSConfiguration(include = c("dsBase",
"dsCCPhos")))
# Returns an environment
LoginBuilder <- DSI::newDSLoginBuilder(.silent = FALSE)
LoginBuilder$append(server = "SiteA",
url = "Server_SiteA",
driver = "DSLiteDriver")
LoginBuilder$append(server = "SiteB",
url = "Server_SiteB",
driver = "DSLiteDriver")
LoginBuilder$append(server = "SiteC",
url = "Server_SiteC",
driver = "DSLiteDriver")
# Returns a data frame of login data to servers
LoginData <- LoginBuilder$build()
# Get list of DSConnection objects of all servers
CCPConnections <- DSI::datashield.login(logins = LoginData,
assign = TRUE)
# Get info about installed packages on servers
DSI::datashield.pkg_status(conns = CCPConnections)
# Get table names of CCP core data set
CCPTableNames_Raw <- dsCCPhos::Meta_TableNames$TableName_Raw
CCPTableNames_Curated <- dsCCPhos::Meta_TableNames$TableName_Curated
# Make tables from data repository accessible in R session
for(i in 1:length(CCPTableNames_Curated))
{
datashield.assign(conns = CCPConnections,
symbol = CCPTableNames_Curated[i],
value = CCPTableNames_Curated[i],
id.name = "_id")
}
# Consolidate all raw data tables in one list object called "RawDataSet"
ds.list(x = CCPTableNames_Curated,
newobj = "RawDataSet",
datasources = CCPConnections)
# Transform Raw Data Set (RDS) into Curated Data Set (CDS)
dsCCPhosClient::ds.CurateData(Name_RawDataSet = "RawDataSet",
Name_Output = "CurationOutput",
DataSources = CCPConnections)
# Get Curation reports
CurationReports <- dsCCPhosClient::ds.GetCurationReport(Name_CurationOutput = "CurationOutput",
DataSources = CCPConnections)
# Exemplary look at a curation report table
View(CurationReports$SiteA$Monitor_Diagnosis)
# For testing purposes
TransformationMonitor <- CurationReports$SiteA
save(TransformationMonitor,
file = "./Development/Reporting/TransformationMonitor.rda")
